#!/bin/bash

# Script para generar colores pywal con intensidad muy reducida
# Genera ambos archivos de colores con la misma configuraciÃ³n suave

HYPRLAND_COLORS="$HOME/.cache/wal/colors-hyprland.conf"
ENHANCED_COLORS="$HOME/.cache/wal/colors-hyprland-enhanced.conf"
TEMP_COLORS="/tmp/original_colors"

# Obtener colores originales de pywal
if [ -f "$HOME/.cache/wal/colors.sh" ]; then
    source "$HOME/.cache/wal/colors.sh"
else
    echo "Error: No se encontraron colores de pywal"
    exit 1
fi

# FunciÃ³n para reducir la intensidad de un color hexadecimal
reduce_intensity() {
    local color="$1"
    local factor="$2"
    
    # Remover el # si existe
    color="${color#\#}"
    
    # Extraer componentes RGB
    local r=$((16#${color:0:2}))
    local g=$((16#${color:2:2}))
    local b=$((16#${color:4:2}))
    
    # Reducir intensidad (mezclar con gris medio)
    local gray=80  # Valor base para mezclar
    r=$(( (r * (100 - factor) + gray * factor) / 100 ))
    g=$(( (g * (100 - factor) + gray * factor) / 100 ))
    b=$(( (b * (100 - factor) + gray * factor) / 100 ))
    
    # Asegurar que no exceda 255
    [ $r -gt 255 ] && r=255
    [ $g -gt 255 ] && g=255  
    [ $b -gt 255 ] && b=255
    
    # Convertir de vuelta a hex
    printf "%02x%02x%02x" $r $g $b
}

# Factor de reducciÃ³n (40% = colores muy suaves)
REDUCTION_FACTOR=45

echo "Generando colores con intensidad reducida (${REDUCTION_FACTOR}%)..."

# Generar archivo principal para hyprland
cat > "$HYPRLAND_COLORS" << EOF
# Hyprland colors generated by pywal - Ultra soft version
# Colors are defined as variables for use in main config

# Ultra soft colors for gentle appearance
\$color0 = rgb($(reduce_intensity "$color0" $REDUCTION_FACTOR))
\$color1 = rgb($(reduce_intensity "$color1" $REDUCTION_FACTOR))  # Primary accent (ultra soft)
\$color2 = rgb($(reduce_intensity "$color2" $REDUCTION_FACTOR))  # Secondary accent
\$color3 = rgb($(reduce_intensity "$color3" $REDUCTION_FACTOR))  # Tertiary accent
\$color4 = rgb($(reduce_intensity "$color4" $REDUCTION_FACTOR))  # Quaternary accent
\$color5 = rgb($(reduce_intensity "$color5" $REDUCTION_FACTOR))  # Quinary accent
\$color6 = rgb($(reduce_intensity "$color6" $REDUCTION_FACTOR))  # Senary accent
\$color7 = rgb($(reduce_intensity "$color7" $REDUCTION_FACTOR))  # Light foreground
\$color8 = rgb($(reduce_intensity "$color8" $REDUCTION_FACTOR))  # Dark accent
\$color9 = rgb($(reduce_intensity "$color9" $REDUCTION_FACTOR))
\$color10 = rgb($(reduce_intensity "$color10" $REDUCTION_FACTOR))
\$color11 = rgb($(reduce_intensity "$color11" $REDUCTION_FACTOR))
\$color12 = rgb($(reduce_intensity "$color12" $REDUCTION_FACTOR))
\$color13 = rgb($(reduce_intensity "$color13" $REDUCTION_FACTOR))
\$color14 = rgb($(reduce_intensity "$color14" $REDUCTION_FACTOR))
\$color15 = rgb($(reduce_intensity "$color15" $REDUCTION_FACTOR))
\$background = rgb($(reduce_intensity "$color0" $REDUCTION_FACTOR))
\$foreground = rgb($(reduce_intensity "$color7" $REDUCTION_FACTOR))  # Ultra soft foreground
EOF

# Generar archivo enhanced (idÃ©ntico) para hyprlock
cat > "$ENHANCED_COLORS" << EOF
# Hyprland colors enhanced for hyprlock - Ultra soft version
# Generated automatically by pywal with heavily reduced saturation for ultra gentle appearance

\$color0 = rgb($(reduce_intensity "$color0" $REDUCTION_FACTOR))
\$color1 = rgb($(reduce_intensity "$color1" $REDUCTION_FACTOR))  # Primary accent (ultra soft)
\$color2 = rgb($(reduce_intensity "$color2" $REDUCTION_FACTOR))  # Secondary accent  
\$color3 = rgb($(reduce_intensity "$color3" $REDUCTION_FACTOR))  # Tertiary accent
\$color4 = rgb($(reduce_intensity "$color4" $REDUCTION_FACTOR))  # Quaternary accent
\$color5 = rgb($(reduce_intensity "$color5" $REDUCTION_FACTOR))  # Quinary accent
\$color6 = rgb($(reduce_intensity "$color6" $REDUCTION_FACTOR))  # Senary accent
\$color7 = rgb($(reduce_intensity "$color7" $REDUCTION_FACTOR))  # Light foreground
\$color8 = rgb($(reduce_intensity "$color8" $REDUCTION_FACTOR))  # Dark accent
\$color9 = rgb($(reduce_intensity "$color9" $REDUCTION_FACTOR))
\$color10 = rgb($(reduce_intensity "$color10" $REDUCTION_FACTOR))
\$color11 = rgb($(reduce_intensity "$color11" $REDUCTION_FACTOR))
\$color12 = rgb($(reduce_intensity "$color12" $REDUCTION_FACTOR))
\$color13 = rgb($(reduce_intensity "$color13" $REDUCTION_FACTOR))
\$color14 = rgb($(reduce_intensity "$color14" $REDUCTION_FACTOR))
\$color15 = rgb($(reduce_intensity "$color15" $REDUCTION_FACTOR))

# Special colors with ultra soft appearance
\$background = rgb($(reduce_intensity "$color0" $REDUCTION_FACTOR))
\$foreground = rgb($(reduce_intensity "$color7" $REDUCTION_FACTOR))  # Ultra soft foreground

# Enhanced colors with ultra gentle appearance  
\$accent_bright = rgb($(reduce_intensity "$color1" $REDUCTION_FACTOR))   # Ultra soft primary
\$success = rgb($(reduce_intensity "$color2" $REDUCTION_FACTOR))         # Ultra soft green
\$warning = rgb($(reduce_intensity "$color3" $REDUCTION_FACTOR))         # Ultra soft yellow
\$error = rgb($(reduce_intensity "$color1" $REDUCTION_FACTOR))           # Ultra soft red
\$text_bright = rgb($(reduce_intensity "$color7" $REDUCTION_FACTOR))     # Ultra soft text
EOF

echo "âœ… Colores ultra suaves generados:"
echo "   - $HYPRLAND_COLORS"
echo "   - $ENHANCED_COLORS"
echo ""
echo "ðŸŽ¨ Aplicando cambios a Hyprland..."

# Recargar configuraciÃ³n de Hyprland
hyprctl reload > /dev/null 2>&1

echo "âœ… Â¡Colores ultra suaves aplicados correctamente!"
echo ""
echo "ðŸ’¡ Los colores ahora tienen ${REDUCTION_FACTOR}% menos intensidad"
echo "ðŸ’¡ Tanto hyprland.conf como hyprlock.conf usan los mismos colores suaves"
echo ""
echo "ðŸ”„ Prueba el powermenu: Super + BackSpace"
echo "ðŸ”’ Prueba hyprlock: Super + L"
