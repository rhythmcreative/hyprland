#!/bin/bash

# Sync Mako with pywal colors
# This script reads pywal colors and updates Mako configuration

# Check if pywal colors exist
if [[ ! -f ~/.cache/wal/colors.sh ]]; then
    echo "Error: pywal colors not found. Run 'wal' first."
    exit 1
fi

# Source pywal colors
source ~/.cache/wal/colors.sh

# Backup original config if it doesn't exist
if [[ ! -f ~/.config/mako/config.backup ]]; then
    cp ~/.config/mako/config ~/.config/mako/config.backup
fi

# Create new Mako config with pywal colors
cat > ~/.config/mako/config << EOF
# Mako - Pywal Synchronized Configuration
# Auto-generated by sync-mako-pywal

# Global appearance
font=SF Pro Display 12
width=400
height=90
margin=15
padding=18
border-size=1
border-radius=12
icons=1
max-icon-size=42
icon-location=left
markup=1
actions=1

# Pywal synchronized colors
background-color=${color0}90
text-color=${color7}
border-color=${color1}50

# Top-right positioning
anchor=top-right
layer=overlay

# Behavior
sort=-time
default-timeout=6000
ignore-timeout=0
max-visible=3

# Icons
icon-path=/usr/share/icons/Papirus-Dark

# Grouping
group-by=app-name
max-history=20

# Volume notifications - HyDE style with circular progress
[app-name=volume]
width=400
height=120
border-radius=15
default-timeout=2000
border-color=${color4}
border-size=2
background-color=${color0}95
text-color=${color7}
padding=20
margin=10

[summary~="Volume"]
width=400
height=120
border-radius=15
default-timeout=2000
border-color=${color4}
border-size=2
background-color=${color0}95
text-color=${color7}
padding=20
margin=10

[summary~="Audio"]
width=400
height=120
border-radius=15
default-timeout=2000
border-color=${color5}
border-size=2
background-color=${color0}95
text-color=${color7}
padding=20
margin=10

# Brightness notifications
[app-name=brightness]
width=320
height=70
border-radius=8
default-timeout=2000
border-color=${color3}60
format=<b>%s</b>

[summary~="Brightness"]
width=320
height=70
border-radius=8
default-timeout=2000
border-color=${color3}60

# Spotify notifications
[app-name=Spotify]
width=440
border-color=${color4}60
default-timeout=6000
background-color=${color0}95

# Urgency levels
[urgency=low]
border-color=${color8}50
default-timeout=4000

[urgency=normal]
border-color=${color1}50
default-timeout=6000

[urgency=critical]
background-color=${color0}95
border-color=${color9}
border-size=2
default-timeout=0
EOF

# Reload Mako to apply changes
makoctl reload 2>/dev/null || echo "Mako configuration updated. Restart Mako to apply changes."

echo "Mako synchronized with pywal colors successfully!"
