#!/bin/bash

# Script de prueba para verificar la sincronizaciÃ³n automÃ¡tica

echo "ğŸ§ª Probando sincronizaciÃ³n automÃ¡tica de pywal-gtk..."

# Verificar que el daemon estÃ¡ ejecutÃ¡ndose
if ! systemctl --user is-active --quiet pywal-gtk-daemon.service; then
    echo "âŒ El daemon no estÃ¡ ejecutÃ¡ndose"
    echo "   Inicia con: systemctl --user start pywal-gtk-daemon.service"
    exit 1
fi

echo "âœ… Daemon ejecutÃ¡ndose"

# Simular cambio ejecutando wal -R
if [ -f "$HOME/.cache/wal/wal" ]; then
    echo "ğŸ”„ Ejecutando wal -R para recargar colores..."
    wal -R
    
    echo "â³ Esperando sincronizaciÃ³n automÃ¡tica (5 segundos)..."
    sleep 5
    
    # Verificar si los archivos CSS fueron actualizados recientemente
    css_gtk3="$HOME/.themes/wal-gtk-auto/gtk-3.0/gtk.css"
    css_gtk4="$HOME/.themes/wal-gtk-auto/gtk-4.0/gtk.css"
    
    if [ -f "$css_gtk3" ] && [ $(find "$css_gtk3" -mtime -1 | wc -l) -gt 0 ]; then
        echo "âœ… Tema GTK3 actualizado automÃ¡ticamente"
    else
        echo "âŒ Tema GTK3 no se actualizÃ³"
    fi
    
    if [ -f "$css_gtk4" ] && [ $(find "$css_gtk4" -mtime -1 | wc -l) -gt 0 ]; then
        echo "âœ… Tema GTK4 actualizado automÃ¡ticamente"
    else
        echo "âŒ Tema GTK4 no se actualizÃ³"
    fi
    
    echo ""
    echo "ğŸ“‹ Estado del daemon:"
    systemctl --user status pywal-gtk-daemon.service --no-pager -l
    
    echo ""
    echo "ğŸ“ Ãšltimas lÃ­neas del log:"
    tail -n 10 "$HOME/.cache/wal/daemon.log" 2>/dev/null || echo "Log no disponible"
    
else
    echo "âŒ No se encontrÃ³ configuraciÃ³n de pywal"
    echo "   Ejecuta 'wal -i /path/to/image' primero"
    exit 1
fi

echo ""
echo "ğŸ‰ Prueba completada"
