#!/bin/bash

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸš€ WALLPAPER LOADER - ULTRA FAST VERSION ğŸš€
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Optimizado para inicio ultra rÃ¡pido de Hyprland
# Reducidos timeouts, eliminados sleeps innecesarios, lÃ³gica simplificada

LOG_FILE="$HOME/.cache/wallpaper-theme.log"

# FunciÃ³n de logging rÃ¡pida
log() {
    echo "$1" >> "$LOG_FILE"
}

# VerificaciÃ³n instantÃ¡nea de swww-daemon
if ! pgrep -x "swww-daemon" > /dev/null; then
    log "ğŸ”§ swww-daemon no detectado, aplicando fallback directo"
    exit 0
fi

# Force specific wallpaper as requested
WALLPAPER_PATH="$HOME/Pictures/Wallpapers/10. Animated.gif"

if [[ -f "$WALLPAPER_PATH" ]]; then
    log "âš¡ Loading requested wallpaper: $(basename "$WALLPAPER_PATH")"
    
    # Generate pywal colors (skip wallpaper set by wal, we use swww)
    # We use -n to skip setting wallpaper, -s to skip changing terminal colors if desired (optional)
    # -t to skip tty
    wal -i "$WALLPAPER_PATH" -n -t > /dev/null 2>&1
    
    # Update current wallpaper cache
    echo "$WALLPAPER_PATH" > "$HOME/.cache/current-wallpaper"
    echo "$WALLPAPER_PATH" > "$HOME/.cache/wal/wal"
    
    # Load wallpaper with swww (supports GIFs)
    swww img "$WALLPAPER_PATH" --transition-type none 2>/dev/null || true
else
    log "âŒ Wallpaper not found: $WALLPAPER_PATH"
fi

log "âœ… Fast wallpaper load complete"
