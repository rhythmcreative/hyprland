#!/bin/bash

# setup-pywal-asusctl-sync
# Script de configuraciÃ³n para sincronizar pywal con teclado ASUS
# Autor: Sistema automÃ¡tico

set -e

echo "ğŸ¨ Configurando sincronizaciÃ³n pywal -> ASUS keyboard..."
echo

# Verificar dependencias
echo "ğŸ” Verificando dependencias..."

if ! command -v wal &> /dev/null; then
    echo "âŒ Error: pywal no estÃ¡ instalado"
    echo "   Instalar con: pip install pywal"
    exit 1
fi

if ! command -v asusctl &> /dev/null; then
    echo "âŒ Error: asusctl no estÃ¡ instalado"
    echo "   Instalar con: pacman -S asusctl"
    exit 1
fi

echo "âœ… Dependencias verificadas"

# Habilitar servicios systemd
echo
echo "ğŸ”§ Habilitando servicios systemd..."

systemctl --user daemon-reload

if systemctl --user enable pywal-asusctl-sync.path; then
    echo "âœ… Servicio habilitado"
else
    echo "âš ï¸  Advertencia: No se pudo habilitar el servicio automÃ¡ticamente"
fi

if systemctl --user start pywal-asusctl-sync.path; then
    echo "âœ… Servicio iniciado"
else
    echo "âš ï¸  Advertencia: No se pudo iniciar el servicio"
fi

# Probar la sincronizaciÃ³n
echo
echo "ğŸ§ª Probando sincronizaciÃ³n inicial..."

if "$HOME/.local/bin/pywal-asusctl-sync"; then
    echo "âœ… SincronizaciÃ³n exitosa!"
else
    echo "âš ï¸  La sincronizaciÃ³n fallÃ³, pero los archivos estÃ¡n configurados"
fi

# InformaciÃ³n adicional
echo
echo "ğŸ“‹ ConfiguraciÃ³n completada!"
echo
echo "ğŸ“ Archivos creados:"
echo "   â€¢ ~/.local/bin/pywal-asusctl-sync (script principal)"
echo "   â€¢ ~/.config/wal/postrun (hook de pywal)"
echo "   â€¢ ~/.config/systemd/user/pywal-asusctl-sync.{service,path}"
echo
echo "ğŸ¯ Uso:"
echo "   â€¢ Los colores se sincronizarÃ¡n automÃ¡ticamente cuando uses pywal"
echo "   â€¢ Para sincronizar manualmente: pywal-asusctl-sync"
echo "   â€¢ Para ver logs: tail -f ~/.local/share/pywal-asusctl/sync.log"
echo
echo "âš™ï¸  PersonalizaciÃ³n:"
echo "   â€¢ Edita ~/.local/bin/pywal-asusctl-sync para cambiar quÃ© color usar"
echo "   â€¢ Por defecto usa color1, luego color2, luego foreground"
echo
echo "ğŸ”§ GestiÃ³n del servicio:"
echo "   â€¢ Estado: systemctl --user status pywal-asusctl-sync.path"
echo "   â€¢ Detener: systemctl --user stop pywal-asusctl-sync.path"
echo "   â€¢ Iniciar: systemctl --user start pywal-asusctl-sync.path"
echo
echo "Â¡Disfruta de tu teclado sincronizado! ğŸŒˆâŒ¨ï¸"
