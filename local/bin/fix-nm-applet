#!/bin/bash

# fix-nm-applet - Script rÃ¡pido para solucionar problemas con nm-applet
# Ãštil cuando nm-applet se mata y no vuelve a iniciarse

echo "ðŸ”§ Solucionando problemas de nm-applet..."

# Matar cualquier instancia colgada
echo "ðŸ›‘ Cerrando instancias problemÃ¡ticas de nm-applet..."
pkill -9 nm-applet 2>/dev/null || true
sleep 1

# Usar el script watchdog para reiniciar limpiamente
echo "ðŸš€ Reiniciando nm-applet..."
if [[ -x "$HOME/.local/bin/nm-applet-watchdog" ]]; then
    "$HOME/.local/bin/nm-applet-watchdog" restart
else
    # Fallback manual
    env GTK_THEME="Arc-Dark" GDK_BACKEND="wayland,x11" nohup nm-applet > /dev/null 2>&1 &
    sleep 2
fi

# Verificar estado
echo "ðŸ“Š Estado final:"
if pgrep -x nm-applet > /dev/null; then
    pid=$(pgrep -x nm-applet)
    echo "âœ… nm-applet estÃ¡ funcionando (PID: $pid)"
    notify-send "âœ… nm-applet" "Reparado exitosamente" -t 3000 2>/dev/null || true
else
    echo "âŒ nm-applet sigue sin funcionar"
    notify-send "âŒ nm-applet" "No se pudo reparar" -t 3000 2>/dev/null || true
fi
