#!/bin/bash

# Script para probar la nueva configuraciÃ³n estable de wallpaper

echo "ðŸ”§ === PRUEBA DE CONFIGURACIÃ“N ESTABLE ==="
echo ""

# Verificar scripts
echo "ðŸ“ Verificando scripts..."
echo "  âœ“ stable-wallpaper-sync: $(ls -la ~/.local/bin/stable-wallpaper-sync 2>/dev/null | cut -d' ' -f1 || echo 'NO ENCONTRADO')"
echo "  âœ“ waybar-watchdog: $(ls -la ~/.local/bin/waybar-watchdog 2>/dev/null | cut -d' ' -f1 || echo 'NO ENCONTRADO')"
echo "  âœ“ waybar-stable-start: $(ls -la ~/.local/bin/waybar-stable-start 2>/dev/null | cut -d' ' -f1 || echo 'NO ENCONTRADO')"
echo ""

# Verificar procesos activos
echo "ðŸ” Verificando procesos activos..."
if pgrep -x waybar > /dev/null; then
    echo "  âœ… Waybar: FUNCIONANDO (PID: $(pgrep -x waybar))"
else
    echo "  âŒ Waybar: NO ESTÃ CORRIENDO"
fi

if pgrep -x nm-applet > /dev/null; then
    echo "  âœ… nm-applet: FUNCIONANDO (PID: $(pgrep -x nm-applet))"
else
    echo "  âš ï¸ nm-applet: NO ESTÃ CORRIENDO"
fi

if pgrep -x swww-daemon > /dev/null; then
    echo "  âœ… swww-daemon: FUNCIONANDO (PID: $(pgrep -x swww-daemon))"
else
    echo "  âŒ swww-daemon: NO ESTÃ CORRIENDO"
fi

echo ""

# Verificar archivos de configuraciÃ³n
echo "ðŸ“ Verificando archivos de configuraciÃ³n..."
if [[ -f "$HOME/.config/waybar/colors-pywal.css" ]]; then
    echo "  âœ… colors-pywal.css: EXISTE"
else
    echo "  âš ï¸ colors-pywal.css: NO EXISTE (se crearÃ¡ con el primer wallpaper)"
fi

if [[ -f "$HOME/.cache/current-wallpaper" ]]; then
    echo "  âœ… current-wallpaper: EXISTE ($(basename "$(cat ~/.cache/current-wallpaper 2>/dev/null)"))"
else
    echo "  âš ï¸ current-wallpaper: NO EXISTE"
fi

if [[ -d "$HOME/Pictures/Wallpapers" ]]; then
    wallpaper_count=$(find "$HOME/Pictures/Wallpapers" -maxdepth 1 -type f \( -iname "*.jpg" -o -iname "*.png" -o -iname "*.jpeg" \) | wc -l)
    echo "  âœ… Directorio wallpapers: EXISTE ($wallpaper_count imÃ¡genes)"
else
    echo "  âŒ Directorio wallpapers: NO EXISTE"
fi

echo ""

# Verificar logs
echo "ðŸ“‹ Logs recientes..."
if [[ -f "$HOME/.cache/stable-wallpaper-sync.log" ]]; then
    echo "  ðŸ“„ Log stable-wallpaper-sync (Ãºltimas 3 lÃ­neas):"
    tail -3 "$HOME/.cache/stable-wallpaper-sync.log" 2>/dev/null | sed 's/^/    /' || echo "    (vacÃ­o)"
fi

if [[ -f "$HOME/.cache/waybar-watchdog.log" ]]; then
    echo "  ðŸ“„ Log waybar-watchdog (Ãºltimas 3 lÃ­neas):"
    tail -3 "$HOME/.cache/waybar-watchdog.log" 2>/dev/null | sed 's/^/    /' || echo "    (vacÃ­o)"
fi

echo ""

# Estado del sistema
echo "ðŸŽ¯ Estado del sistema..."
current_theme=$(gsettings get org.gnome.desktop.interface gtk-theme 2>/dev/null || echo "'no disponible'")
current_icons=$(gsettings get org.gnome.desktop.interface icon-theme 2>/dev/null || echo "'no disponible'")
echo "  ðŸŽ¨ Tema GTK: $current_theme"
echo "  ðŸŽ¯ Iconos: $current_icons"

echo ""
echo "ðŸš€ === CONFIGURACIÃ“N LISTA PARA USAR ==="
echo ""
echo "ðŸ“Œ Para cambiar wallpaper, usa: Super + Shift + W"
echo "ðŸ“Œ Para recargar waybar: Super + Alt + R"
echo "ðŸ“Œ Para emergencias de waybar: Super + Ctrl + R"
echo ""
echo "âœ¨ Â¡El sistema estÃ¡ optimizado para evitar problemas con workspaces y nm-applet!"
