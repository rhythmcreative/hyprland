#!/bin/bash

# Script de control para el servicio de sincronizaci√≥n autom√°tica de SDDM wallpaper
# Uso: sddm-watcher-control [start|stop|restart|status|logs|sync-now]

SERVICE_NAME="sddm-wallpaper-watcher.service"
LOG_FILE="$HOME/.cache/sddm-wallpaper-watcher.log"

case "${1:-status}" in
    "start")
        echo "üöÄ Iniciando servicio de sincronizaci√≥n autom√°tica de SDDM..."
        systemctl --user start "$SERVICE_NAME"
        if [[ $? -eq 0 ]]; then
            echo "‚úÖ Servicio iniciado exitosamente"
        else
            echo "‚ùå Error al iniciar el servicio"
            exit 1
        fi
        ;;
        
    "stop")
        echo "üõë Deteniendo servicio de sincronizaci√≥n autom√°tica de SDDM..."
        systemctl --user stop "$SERVICE_NAME"
        if [[ $? -eq 0 ]]; then
            echo "‚úÖ Servicio detenido exitosamente"
        else
            echo "‚ùå Error al detener el servicio"
            exit 1
        fi
        ;;
        
    "restart")
        echo "üîÑ Reiniciando servicio de sincronizaci√≥n autom√°tica de SDDM..."
        systemctl --user restart "$SERVICE_NAME"
        if [[ $? -eq 0 ]]; then
            echo "‚úÖ Servicio reiniciado exitosamente"
        else
            echo "‚ùå Error al reiniciar el servicio"
            exit 1
        fi
        ;;
        
    "status")
        echo "üìä Estado del servicio de sincronizaci√≥n autom√°tica de SDDM:"
        echo ""
        systemctl --user status "$SERVICE_NAME" --no-pager
        ;;
        
    "logs")
        echo "üìù Logs del servicio (√∫ltimas 20 l√≠neas):"
        echo ""
        if [[ -f "$LOG_FILE" ]]; then
            tail -20 "$LOG_FILE"
        else
            echo "‚ùå No se encontr√≥ el archivo de log: $LOG_FILE"
        fi
        ;;
        
    "sync-now")
        echo "‚ö° Ejecutando sincronizaci√≥n manual de SDDM wallpaper..."
        "$HOME/.local/bin/sync-sddm-wallpaper-sudo"
        if [[ $? -eq 0 ]]; then
            echo "‚úÖ Sincronizaci√≥n manual completada"
        else
            echo "‚ùå Error en la sincronizaci√≥n manual"
            exit 1
        fi
        ;;
        
    "enable")
        echo "üîß Habilitando servicio para inicio autom√°tico..."
        systemctl --user enable "$SERVICE_NAME"
        if [[ $? -eq 0 ]]; then
            echo "‚úÖ Servicio habilitado para inicio autom√°tico"
        else
            echo "‚ùå Error al habilitar el servicio"
            exit 1
        fi
        ;;
        
    "disable")
        echo "üîß Deshabilitando servicio de inicio autom√°tico..."
        systemctl --user disable "$SERVICE_NAME"
        if [[ $? -eq 0 ]]; then
            echo "‚úÖ Servicio deshabilitado del inicio autom√°tico"
        else
            echo "‚ùå Error al deshabilitar el servicio"
            exit 1
        fi
        ;;
        
    "help"|"-h"|"--help")
        echo "Script de control para el servicio de sincronizaci√≥n autom√°tica de SDDM wallpaper"
        echo ""
        echo "Uso: sddm-watcher-control [comando]"
        echo ""
        echo "Comandos disponibles:"
        echo "  start      - Iniciar el servicio"
        echo "  stop       - Detener el servicio"
        echo "  restart    - Reiniciar el servicio"
        echo "  status     - Mostrar estado del servicio (default)"
        echo "  logs       - Mostrar logs del servicio"
        echo "  sync-now   - Ejecutar sincronizaci√≥n manual inmediata"
        echo "  enable     - Habilitar inicio autom√°tico del servicio"
        echo "  disable    - Deshabilitar inicio autom√°tico del servicio"
        echo "  help       - Mostrar esta ayuda"
        echo ""
        echo "El servicio monitorea autom√°ticamente cambios en tu wallpaper"
        echo "y sincroniza SDDM para que use el mismo fondo de pantalla."
        ;;
        
    *)
        echo "‚ùå Comando desconocido: $1"
        echo "Usa 'sddm-watcher-control help' para ver comandos disponibles"
        exit 1
        ;;
esac
