#!/bin/bash

# Waybar Theme Switcher - Cambia entre temas standard y varied
# Uso: waybar-theme-switch [standard|varied]

THEME_FILE="$HOME/.config/waybar/.current_theme"
CACHE_DIR="$HOME/.cache/wal"

show_usage() {
    echo "ğŸ¨ Waybar Theme Switcher"
    echo "Uso: waybar-theme-switch [standard|varied]"
    echo ""
    echo "Temas disponibles:"
    echo "  standard  - Colores pywal estÃ¡ndar en todos los mÃ³dulos"
    echo "  varied    - Colores distribuidos + color fijo para clima (recomendado)"
    echo ""
    echo "Tema actual: $(cat "$THEME_FILE" 2>/dev/null || echo 'desconocido')"
}

apply_theme() {
    local theme="$1"
    
    # Guardar preferencia
    echo "$theme" > "$THEME_FILE"
    
    # Aplicar tema inmediatamente
    if [[ "$theme" == "varied" && -f "$CACHE_DIR/waybar-style-varied.css" ]]; then
        cp "$CACHE_DIR/waybar-style-varied.css" "$HOME/.config/waybar/style.css"
        echo "âœ… Aplicado tema varied - Colores distribuidos + clima fijo"
    elif [[ -f "$CACHE_DIR/waybar-style.css" ]]; then
        cp "$CACHE_DIR/waybar-style.css" "$HOME/.config/waybar/style.css"
        echo "âœ… Aplicado tema standard - Todos los mÃ³dulos con colores pywal"
    else
        echo "âŒ Error: Archivos de tema no encontrados. Ejecuta 'wal -R' primero."
        exit 1
    fi
    
    # Recargar waybar
    if pgrep -x waybar > /dev/null; then
        pkill -USR1 waybar 2>/dev/null || {
            pkill waybar
            sleep 0.5
            nohup waybar > /dev/null 2>&1 &
        }
        echo "ğŸ”„ Waybar recargado con el nuevo tema!"
    else
        nohup waybar > /dev/null 2>&1 &
        echo "ğŸš€ Waybar iniciado con el nuevo tema!"
    fi
}

# Procesar argumentos
case "$1" in
    "standard")
        apply_theme "standard"
        ;;
    "varied")
        apply_theme "varied"
        ;;
    "")
        show_usage
        ;;
    *)
        echo "âŒ Tema desconocido: $1"
        show_usage
        exit 1
        ;;
esac
