#!/bin/bash

# Comando simple para sincronizar nm-applet con waybar
# Uso: sync-nm-applet

echo "ğŸ¨ Sincronizando nm-applet con colores de Waybar..."

# Extraer colores actuales
BG_COLOR=$(grep "^background=" "$HOME/.cache/wal/colors.sh" | cut -d"'" -f2)
FG_COLOR=$(grep "^foreground=" "$HOME/.cache/wal/colors.sh" | cut -d"'" -f2)
ACCENT_COLOR=$(grep "^color4=" "$HOME/.cache/wal/colors.sh" | cut -d"'" -f2)

if [[ -z "$BG_COLOR" || -z "$FG_COLOR" || -z "$ACCENT_COLOR" ]]; then
    echo "âŒ Error: No se pudieron extraer los colores de waybar"
    echo "   AsegÃºrate de que pywal estÃ© configurado correctamente"
    exit 1
fi

echo "âœ… Colores detectados:"
echo "   â€¢ Background: $BG_COLOR"
echo "   â€¢ Foreground: $FG_COLOR" 
echo "   â€¢ Accent: $ACCENT_COLOR"

# Reiniciar nm-applet
echo "ğŸ”„ Reiniciando nm-applet..."
pkill nm-applet 2>/dev/null
sleep 1
nohup nm-applet > /dev/null 2>&1 &
sleep 2

if pgrep nm-applet > /dev/null; then
    echo "âœ… nm-applet reiniciado exitosamente"
    
    # NotificaciÃ³n
    if command -v notify-send > /dev/null; then
        notify-send "ğŸ¨ SincronizaciÃ³n completa" \
                   "nm-applet ahora usa los colores de waybar" \
                   -t 2000 -i network-wireless 2>/dev/null || true
    fi
else
    echo "âŒ Error al reiniciar nm-applet"
    exit 1
fi

echo "ğŸ‰ Â¡SincronizaciÃ³n completada!"
