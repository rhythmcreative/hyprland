#!/bin/bash

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸš€ WALLPAPER LOADER - ULTRA FAST VERSION ðŸš€
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Optimizado para inicio ultra rÃ¡pido de Hyprland
# Reducidos timeouts, eliminados sleeps innecesarios, lÃ³gica simplificada

LOG_FILE="$HOME/.cache/wallpaper-theme.log"

# FunciÃ³n de logging rÃ¡pida (sin timestamp para reducir overhead)
log() {
    echo "$1" >> "$LOG_FILE"
}

# VerificaciÃ³n instantÃ¡nea de swww-daemon
if ! pgrep -x "swww-daemon" > /dev/null; then
    log "ðŸ”§ swww-daemon no detectado, aplicando fallback directo"
    exit 0
fi

# Carga directa del wallpaper sin verificaciones pesadas
if [[ -f "$HOME/.cache/current-wallpaper" ]]; then
    WALLPAPER_PATH=$(cat "$HOME/.cache/current-wallpaper")
    
    if [[ -f "$WALLPAPER_PATH" ]]; then
        # GIF detection - ultra light check
        if [[ "${WALLPAPER_PATH,,}" == *.gif ]]; then
            log "âš¡ GIF skipped for speed - fallback solid"
            swww img <(convert -size 1920x1080 xc:"#2e3440" png:-) --transition-type none 2>/dev/null || true
        else
            log "âš¡ Loading: $(basename "$WALLPAPER_PATH")"
            # Ultra fast transition - no fancy effects
            swww img "$WALLPAPER_PATH" --transition-type none 2>/dev/null || true
        fi
    fi
elif [[ -f "$HOME/.cache/wal/wal" ]]; then
    # Fallback directo a pywal sin verificaciones
    FALLBACK_WALLPAPER=$(cat "$HOME/.cache/wal/wal")
    log "âš¡ Pywal fallback: $(basename "$FALLBACK_WALLPAPER")"
    swww img "$FALLBACK_WALLPAPER" --transition-type none 2>/dev/null || true
fi

log "âœ… Fast wallpaper load complete"
