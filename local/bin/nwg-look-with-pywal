#!/bin/bash

# Wrapper para nwg-look que tambi√©n ejecuta pywal-gtk4 generate
# Uso: nwg-look-with-pywal [argumentos de nwg-look]

# Funci√≥n para mostrar ayuda
show_help() {
    echo "üé® nwg-look-with-pywal - Wrapper que ejecuta nwg-look y pywal-gtk4"
    echo ""
    echo "Este script ejecuta nwg-look con los argumentos proporcionados y luego"
    echo "ejecuta pywal-gtk4 generate para sincronizar los temas."
    echo ""
    echo "ARGUMENTOS DE NWG-LOOK:"
    nwg-look --help 2>/dev/null || echo "  -a    Aplicar configuraci√≥n guardada y salir"
    echo ""
    echo "ARGUMENTOS ADICIONALES:"
    echo "  --no-pywal    No ejecutar pywal-gtk4 generate"
    echo "  --help        Mostrar esta ayuda"
    echo ""
    echo "EJEMPLOS:"
    echo "  nwg-look-with-pywal                # Abrir GUI y generar tema"
    echo "  nwg-look-with-pywal -a             # Aplicar tema y generar"
    echo "  nwg-look-with-pywal --no-pywal     # Solo nwg-look"
}

# Variables
run_pywal=true
nwg_args=()

# Procesar argumentos
while [[ $# -gt 0 ]]; do
    case $1 in
        --no-pywal)
            run_pywal=false
            shift
            ;;
        --help)
            show_help
            exit 0
            ;;
        *)
            nwg_args+=("$1")
            shift
            ;;
    esac
done

# Verificar que pywal-gtk4 existe
if [[ ! -x "$HOME/.local/bin/pywal-gtk4" ]] && $run_pywal; then
    echo "‚ö†Ô∏è  Advertencia: pywal-gtk4 no encontrado en ~/.local/bin/pywal-gtk4"
    echo "   Continuando solo con nwg-look..."
    run_pywal=false
fi

# Ejecutar nwg-look
echo "üöÄ Ejecutando nwg-look ${nwg_args[*]}"
if ! nwg-look "${nwg_args[@]}"; then
    echo "‚ùå Error al ejecutar nwg-look"
    exit 1
fi

# Ejecutar pywal-gtk4 si est√° habilitado
if $run_pywal; then
    echo ""
    echo "üé® Generando tema GTK4 con pywal-gtk4..."
    if ~/.local/bin/pywal-gtk4 generate; then
        echo "‚úÖ Tema GTK4 generado exitosamente"
    else
        echo "‚ö†Ô∏è  Error al generar tema GTK4 (c√≥digo de salida: $?)"
        echo "   Los cambios de nwg-look se aplicaron correctamente."
    fi
fi

echo "üéØ Proceso completado"
