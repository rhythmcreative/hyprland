#!/bin/bash
# Script maestro para sincronizar todos los componentes con pywal
# Actualiza Kitty, Oh My Posh, y otros elementos automÃ¡ticamente

echo "ðŸŽ¨ Sincronizando todos los componentes con pywal..."

# Verificar que pywal estÃ© configurado
if [ ! -f ~/.cache/wal/colors.sh ]; then
    echo "âŒ Error: pywal no estÃ¡ configurado correctamente"
    echo "   Ejecuta: wal -i /ruta/a/tu/imagen"
    exit 1
fi

# Cargar colores de pywal
source ~/.cache/wal/colors.sh

echo "ðŸ“¦ Actualizando componentes..."

# 1. Actualizar Oh My Posh
echo "  â€¢ Oh My Posh..."
/home/rhythmcreative/.local/bin/update-omp-pywal > /dev/null 2>&1
if [ $? -eq 0 ]; then
    echo "    âœ“ Oh My Posh actualizado"
else
    echo "    âŒ Error actualizando Oh My Posh"
fi

# 2. Kitty ya se actualiza automÃ¡ticamente con ~/.cache/wal/colors-kitty.conf
echo "  â€¢ Kitty..."
if [ -f ~/.cache/wal/colors-kitty.conf ]; then
    echo "    âœ“ Kitty configurado (usa colors-kitty.conf automÃ¡ticamente)"
else
    echo "    âŒ Error: archivo colors-kitty.conf no encontrado"
fi

# 3. Recargar configuraciÃ³n de zsh si estamos en una sesiÃ³n interactiva
echo "  â€¢ Terminal ZSH..."
if [ -n "$ZSH_VERSION" ] && [ -t 0 ]; then
    # Recargar configuraciÃ³n
    source ~/.zshrc > /dev/null 2>&1
    echo "    âœ“ ConfiguraciÃ³n ZSH recargada"
else
    echo "    â­  ZSH serÃ¡ actualizado en la prÃ³xima sesiÃ³n"
fi

# 4. Actualizar aplicaciones que soportan pywal
echo "  â€¢ Aplicaciones adicionales..."

# Hyprland (si existe)
if [ -f ~/.cache/wal/colors-hyprland.conf ]; then
    echo "    âœ“ Hyprland configurado"
fi

# Rofi (si estÃ¡ instalado)
if command -v rofi &> /dev/null; then
    if [ -f ~/.cache/wal/colors-rofi-dark.rasi ]; then
        echo "    âœ“ Rofi configurado"
    fi
fi

# Qt/KDE Apps (Dolphin, etc.)
if [ -x ~/.local/bin/sync-qt-pywal ]; then
    echo "  â€¢ Qt/KDE (Dolphin, aplicaciones Qt)..."
    ~/.local/bin/sync-qt-pywal > /dev/null 2>&1
    if [ $? -eq 0 ]; then
        echo "    âœ“ Qt/KDE sincronizado con PyWal"
    else
        echo "    âœ— Error sincronizando Qt/KDE"
    fi
fi

# 5. Notificar el cambio
if command -v notify-send &> /dev/null; then
    notify-send "ðŸŽ¨ Pywal Sync" "Todos los componentes actualizados con el nuevo tema" -t 3000
fi

echo ""
echo "ðŸŽ‰ Â¡SincronizaciÃ³n completa!"
echo "   Colores principales:"
echo "   â€¢ Fondo: $background"
echo "   â€¢ Texto: $foreground"
echo "   â€¢ Acento: $color6"
echo "   â€¢ Ã‰xito: $color2"
echo "   â€¢ Advertencia: $color3"
echo "   â€¢ Error: $color1"
echo ""
echo "ðŸ’¡ Para aplicar cambios completos:"
echo "   â€¢ Reinicia Kitty: Ctrl+Shift+F5"
echo "   â€¢ Nueva terminal: Ctrl+Shift+Enter"
echo "   â€¢ Recarga manual: source ~/.zshrc"
echo ""
echo "ðŸš€ Las sugerencias inteligentes estÃ¡n activas:"
echo "   â€¢ Autocompletado: Escribe y ve sugerencias automÃ¡ticas"
echo "   â€¢ BÃºsqueda fuzzy: Ctrl+T (archivos) / Ctrl+R (historia)"
echo "   â€¢ Historia inteligente: Flechas â†‘â†“ buscan en comandos previos"
echo "   â€¢ Syntax highlighting: Los comandos se colorean automÃ¡ticamente"
