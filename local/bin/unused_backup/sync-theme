#!/bin/bash

# Script para sincronizar pywal con Oh My Posh y Kitty
# Uso: sync-theme [imagen]

WALLPAPER="$1"
CONFIG_DIR="$HOME/.config/oh-my-posh"
THEME_FILE="$CONFIG_DIR/pywal-theme.omp.json"

# Funci√≥n para mostrar ayuda
show_help() {
    echo "Uso: sync-theme [imagen]"
    echo "    imagen: Ruta a la imagen de wallpaper (opcional)"
    echo ""
    echo "Si no se especifica imagen, usa pywal con la configuraci√≥n actual"
    echo ""
    echo "Ejemplos:"
    echo "    sync-theme ~/Pictures/wallpaper.jpg"
    echo "    sync-theme  # Usa el wallpaper actual"
    exit 0
}

# Verificar ayuda
if [[ "$1" == "-h" || "$1" == "--help" ]]; then
    show_help
fi

# Aplicar pywal si se proporciona una imagen
if [[ -n "$WALLPAPER" ]]; then
    if [[ ! -f "$WALLPAPER" ]]; then
        echo "Error: El archivo '$WALLPAPER' no existe."
        exit 1
    fi
    
    echo "üé® Aplicando nueva paleta de colores con pywal..."
    wal -i "$WALLPAPER" -q
else
    echo "üîÑ Actualizando tema con colores actuales de pywal..."
    if [[ ! -f "$HOME/.cache/wal/colors.json" ]]; then
        echo "‚ùå No se encontraron colores de pywal. Ejecuta 'wal -i <imagen>' primero."
        exit 1
    fi
fi

# Actualizar tema de Oh My Posh
echo "üöÄ Actualizando tema de Oh My Posh..."
"$HOME/.local/bin/sync-omp-pywal"

# Reiniciar Kitty si est√° corriendo (opcional)
if pgrep -x "kitty" > /dev/null; then
    echo "üê± Kitty detectado, los colores se actualizar√°n autom√°ticamente"
fi

# Mensaje de √©xito
echo "‚úÖ Tema sincronizado exitosamente!"
echo "üí° Reinicia tu terminal para ver todos los cambios"
echo ""
echo "üéØ Para aplicar cambios inmediatamente, ejecuta:"
echo "   source ~/.bashrc"
