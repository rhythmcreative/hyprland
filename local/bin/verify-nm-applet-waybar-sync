#!/bin/bash

# Script para verificar que nm-applet est√° sincronizado con waybar colors

echo "üîç Verificando sincronizaci√≥n nm-applet ‚Üî waybar..."

# Load current pywal colors
if [[ -f "$HOME/.cache/wal/colors.sh" ]]; then
    source "$HOME/.cache/wal/colors.sh"
    echo "üìä Colores pywal actuales:"
    echo "  Background: $background"
    echo "  Foreground: $foreground" 
    echo "  Accent: $color4"
else
    echo "‚ùå No se encontraron colores de pywal"
    exit 1
fi

# Check if CSS files exist and have correct colors
GTK3_CSS="$HOME/.config/gtk-3.0/nm-applet-waybar.css"
GTK4_CSS="$HOME/.config/gtk-4.0/nm-applet-waybar.css"

echo "üé® Verificando archivos CSS..."

if [[ -f "$GTK3_CSS" ]]; then
    if grep -q "$background" "$GTK3_CSS" && grep -q "$foreground" "$GTK3_CSS" && grep -q "$color4" "$GTK3_CSS"; then
        echo "‚úÖ CSS GTK3 tiene colores correctos"
    else
        echo "‚ùå CSS GTK3 necesita actualizaci√≥n"
        echo "  Ejecuta: nm-applet-waybar-sync"
    fi
else
    echo "‚ùå CSS GTK3 no existe"
fi

if [[ -f "$GTK4_CSS" ]]; then
    if grep -q "$background" "$GTK4_CSS" && grep -q "$foreground" "$GTK4_CSS" && grep -q "$color4" "$GTK4_CSS"; then
        echo "‚úÖ CSS GTK4 tiene colores correctos"
    else
        echo "‚ùå CSS GTK4 necesita actualizaci√≥n"
        echo "  Ejecuta: nm-applet-waybar-sync"
    fi
else
    echo "‚ùå CSS GTK4 no existe"
fi

# Check if nm-applet is running
if pgrep -x nm-applet > /dev/null; then
    echo "‚úÖ nm-applet est√° ejecut√°ndose"
else
    echo "‚ùå nm-applet no est√° ejecut√°ndose"
    echo "  Ejecutando: nm-applet &"
    nm-applet > /dev/null 2>&1 &
fi

# Check waybar colors
WAYBAR_CSS="$HOME/.config/waybar/colors-pywal.css"
if [[ -f "$WAYBAR_CSS" ]]; then
    if grep -q "$background" "$WAYBAR_CSS" && grep -q "$foreground" "$WAYBAR_CSS"; then
        echo "‚úÖ Waybar CSS tiene colores correctos"
    else
        echo "‚ùå Waybar CSS desactualizado"
    fi
else
    echo "‚ùå Waybar CSS no encontrado"
fi

echo "üéâ Verificaci√≥n completada"
