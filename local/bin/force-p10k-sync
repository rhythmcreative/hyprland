#!/bin/bash

# Script para forzar sincronizaci√≥n entre Kitty, P10k y PyWal
# Uso: force-p10k-sync

echo "üîÑ Forzando sincronizaci√≥n Kitty + Powerlevel10k + PyWal..."

# 1. Verificar que pywal tenga colores generados
if [[ ! -f "$HOME/.cache/wal/colors.json" ]]; then
    echo "‚ùå Error: No se encontraron colores de PyWal"
    echo "üí° Ejecuta 'wal -i /path/to/image' primero"
    exit 1
fi

# 2. Regenerar colores de P10k
if [[ -f "$HOME/.cache/wal/p10k-colors.zsh" ]]; then
    echo "üìù Recargando colores de Powerlevel10k..."
    source "$HOME/.cache/wal/p10k-colors.zsh"
    echo "‚úÖ Colores de P10k recargados"
else
    echo "‚ö†Ô∏è Archivo p10k-colors.zsh no encontrado"
fi

# 3. Recargar Kitty
if command -v kitty >/dev/null 2>&1; then
    echo "üê± Recargando configuraci√≥n de Kitty..."
    kitty @ load-config 2>/dev/null || echo "‚ö†Ô∏è No se pudo recargar Kitty autom√°ticamente"
    echo "‚úÖ Kitty sincronizado"
fi

# 4. Aplicar colores pywal
if [[ -f "$HOME/.cache/wal/sequences" ]]; then
    echo "üé® Aplicando secuencias de color..."
    cat "$HOME/.cache/wal/sequences"
    echo "‚úÖ Secuencias aplicadas"
fi

# 5. Ejecutar hooks personalizados si existen
if [[ -x "$HOME/.local/bin/apply-pywal-colors-now" ]]; then
    echo "‚ö° Ejecutando hooks personalizados..."
    "$HOME/.local/bin/apply-pywal-colors-now"
fi

echo ""
echo "‚ú® Sincronizaci√≥n completada"
echo "üí° Si usas zsh, ejecuta 'source ~/.zshrc' para recargar completamente"
echo "üí° O abre una nueva terminal para ver los cambios"
