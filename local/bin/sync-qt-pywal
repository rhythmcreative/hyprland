#!/bin/bash

# Script para sincronizar Qt/KDE con PyWal
# Este script actualiza automÃ¡ticamente los colores de Qt/KDE cuando cambian los colores de PyWal

# Cargar colores de PyWal
source ~/.cache/wal/colors.sh

# FunciÃ³n para convertir hex a RGB
hex_to_rgb() {
    hex=$1
    hex=${hex#"#"}
    r=$((16#${hex:0:2}))
    g=$((16#${hex:2:2}))
    b=$((16#${hex:4:2}))
    echo "$r,$g,$b"
}

# Crear directorio si no existe
mkdir -p ~/.config/Kvantum/PywalAdapta
mkdir -p ~/.local/share/color-schemes

# Actualizar tema Kvantum con colores de PyWal
cat > ~/.config/Kvantum/PywalAdapta/PywalAdapta.kvconfig << EOF
[%General]
author=Pywal Sync
comment=A Kvantum theme that automatically syncs with pywal colors
x11drag=menubar_and_primary_toolbar
alt_mnemonic=true
left_tabs=true
attach_active_tab=false
mirror_doc_tabs=true
groupbox_top_label=true
spread_progressbar=true
composite=true
menu_shadow_depth=5
tooltip_shadow_depth=6
splitter_width=4
scroll_width=9
scroll_arrows=false
scroll_min_extent=60
slider_width=6
slider_handle_width=18
slider_handle_length=18
center_toolbar_handle=true
check_size=16
textless_progressbar=false
progressbar_thickness=2
menubar_mouse_tracking=true
toolbutton_style=1
double_click=false
translucent_windows=false
blurring=false
popup_blurring=false
vertical_spin_indicators=false
spin_button_width=24
fill_rubberband=false
merge_menubar_with_toolbar=true
small_icon_size=16
large_icon_size=32
button_icon_size=16
toolbar_icon_size=16
combo_as_lineedit=true
animate_states=true
button_contents_shift=false
combo_menu=true
hide_combo_checkboxes=false
combo_focus_rect=false
groupbox_top_label=true
inline_spin_indicators=false
joined_inactive_tabs=false
layout_spacing=6
layout_margin=9
scrollbar_in_view=true
transient_scrollbar=true
transient_groove=false
submenu_overlap=0
tooltip_delay=-1
tree_branch_line=true
no_window_pattern=false
opaque=kaffeine,kmplayer,subtitlecomposer,kdenlive,vlc,smplayer,smplayer2,avidemux,avidemux2_qt4,avidemux3_qt4,avidemux3_qt5,kamoso,QtCreator,VirtualBox,trojita,dragon,digikam
reduce_window_opacity=0
respect_DE=true
scrollable_menu=true
submenu_delay=250

[GeneralColors]
window.color=$background
base.color=$background
alt.base.color=$color0
button.color=$color0
light.color=$color8
mid.light.color=$color0
dark.color=$background
mid.color=$background
text.color=$foreground
window.text.color=$foreground
button.text.color=$foreground
disabled.text.color=$color8
tooltip.text.color=$foreground
highlight.color=$color1
highlight.text.color=#ffffff
link.color=$color4
link.visited.color=$color5
progress.indicator.text.color=#ffffff

[Hacks]
transparent_ktitle_label=false
transparent_dolphin_view=true
transparent_pcmanfm_sidepane=true
blur_translucent=false
transparent_menutitle=false
respect_darkness=true
kcapacitybar_as_progressbar=true
force_size_grip=true
iconless_pushbutton=true
iconless_menu=false
disabled_icon_opacity=100
lxqtmainmenu_iconsize=16
normal_default_pushbutton=true
single_top_toolbar=true
tint_on_mouseover=0
transparent_pcmanfm_view=false
no_selection_tint=false
transparent_arrow_button=true
middle_click_scroll=false
opaque_colors=false

[PanelButtonCommand]
frame=true
frame.element=button
frame.top=4
frame.bottom=4
frame.left=4
frame.right=4
interior=true
interior.element=button
indicator.size=9
text.normal.color=$foreground
text.focus.color=#ffffff
text.press.color=#ffffff
text.toggle.color=#ffffff
text.shadow=0
text.margin=1
text.iconspacing=4
indicator.element=arrow
text.margin.top=2
text.margin.bottom=2
text.margin.left=2
text.margin.right=2
frame.expansion=14

[PanelButtonTool]
inherits=PanelButtonCommand
text.normal.color=$foreground
text.bold=false
indicator.element=arrow
indicator.size=9
frame.expansion=34

[ToolbarButton]
frame.element=tbutton
interior.element=tbutton
indicator.element=tarrow
text.normal.color=$foreground
text.focus.color=#ffffff
text.press.color=#ffffff
text.toggle.color=#ffffff
text.bold=false
frame.expansion=34

[Dock]
inherits=PanelButtonCommand
interior.element=dock
frame.element=dock
frame.top=1
frame.bottom=1
frame.left=1
frame.right=1
text.normal.color=$foreground

[DockTitle]
inherits=PanelButtonCommand
frame=false
interior=false
text.normal.color=$foreground
text.focus.color=#ffffff
text.bold=false

[IndicatorSpinBox]
inherits=PanelButtonCommand
frame=true
interior=true
frame.top=2
frame.bottom=2
frame.left=2
frame.right=2
indicator.element=spin
indicator.size=10
text.normal.color=$foreground

[RadioButton]
inherits=PanelButtonCommand
frame=false
interior.element=radio
text.normal.color=$foreground
text.focus.color=#ffffff
min_width=+0.3font
min_height=+0.3font

[CheckBox]
inherits=PanelButtonCommand
frame=false
interior.element=checkbox
text.normal.color=$foreground
text.focus.color=#ffffff
min_width=+0.3font
min_height=+0.3font

[Focus]
inherits=PanelButtonCommand
frame=true
frame.element=focus
frame.top=1
frame.bottom=1
frame.left=1
frame.right=1
frame.patternsize=20

[GenericFrame]
inherits=PanelButtonCommand
frame=true
interior=false
frame.element=common
interior.element=common
frame.top=3
frame.bottom=3
frame.left=3
frame.right=3

[LineEdit]
inherits=PanelButtonCommand
frame.element=lineedit
interior.element=lineedit
interior=true
frame.top=2
frame.bottom=2
frame.left=2
frame.right=2
text.margin.top=2
text.margin.bottom=2
text.margin.left=2
text.margin.right=2
frame.expansion=0

[DropDownButton]
inherits=PanelButtonCommand
indicator.element=arrow-down

[IndicatorArrow]
indicator.element=arrow
indicator.size=9

[ToolboxTab]
inherits=PanelButtonCommand
text.normal.color=$foreground
text.press.color=$foreground
text.focus.color=#ffffff

[Tab]
inherits=PanelButtonCommand
interior.element=tab
text.margin.left=8
text.margin.right=8
text.margin.top=2
text.margin.bottom=2
frame.element=tab
indicator.element=tab
indicator.size=22
frame.top=2
frame.bottom=2
frame.left=2
frame.right=2
text.normal.color=$color8
text.focus.color=$foreground
text.toggle.color=$foreground
frame.expansion=0
text.bold=false
focusFrame=true

[TabFrame]
inherits=PanelButtonCommand
frame.element=tabframe
interior.element=tabframe
frame.top=2
frame.bottom=2
frame.left=2
frame.right=2

[TreeExpander]
inherits=PanelButtonCommand
indicator.size=9
indicator.element=tree

[HeaderSection]
inherits=PanelButtonCommand
interior.element=header
frame.element=header
frame.top=1
frame.bottom=1
frame.left=1
frame.right=1
text.normal.color=$foreground
text.focus.color=#ffffff
text.press.color=#ffffff
text.toggle.color=#ffffff
frame.expansion=0

[SizeGrip]
indicator.element=resize-grip

[Toolbar]
inherits=PanelButtonCommand
indicator.element=toolbar
indicator.size=5
text.margin=0
interior.element=menubar
frame.element=menubar
text.normal.color=$foreground
text.focus.color=#ffffff
frame.bottom=0
frame.expansion=0

[Slider]
inherits=PanelButtonCommand
frame.element=slider
focusFrame=true
interior.element=slider
frame.top=3
frame.bottom=3
frame.left=3
frame.right=3

[SliderCursor]
inherits=PanelButtonCommand
frame=false
interior.element=slidercursor
indicator.element=slidercursor

[Progressbar]
inherits=PanelButtonCommand
frame.element=progress
interior.element=progress
text.margin=0
text.normal.color=#ffffff
text.focus.color=#ffffff
text.press.color=#ffffff
text.toggle.color=#ffffff
text.bold=false
frame.expansion=8

[ProgressbarContents]
inherits=PanelButtonCommand
frame=true
frame.element=progress-pattern
interior.element=progress-pattern

[ItemView]
inherits=PanelButtonCommand
text.margin=0
frame.element=itemview
interior.element=itemview
frame.top=2
frame.bottom=2
frame.left=2
frame.right=2
text.margin.top=2
text.margin.bottom=2
text.margin.left=4
text.margin.right=4
text.normal.color=$foreground
text.focus.color=#ffffff
text.press.color=#ffffff
text.toggle.color=#ffffff
min_height=+0.3font
min_width=+0.3font
frame.expansion=0

[Splitter]
indicator.size=48

[Scrollbar]
inherits=PanelButtonCommand
indicator.element=arrow
indicator.size=10

[ScrollbarSlider]
inherits=PanelButtonCommand
frame.element=scrollbarslider
interior=false
frame.left=5
frame.right=5
frame.top=5
frame.bottom=5
indicator.element=grip
indicator.size=13

[ScrollbarGroove]
inherits=PanelButtonCommand
interior=false
frame=false

[MenuItem]
inherits=PanelButtonCommand
frame=true
frame.element=menuitem
interior.element=menuitem
indicator.element=menuitem
text.normal.color=$foreground
text.focus.color=#ffffff
text.margin.top=1
text.margin.bottom=1
text.margin.left=15
text.margin.right=5
frame.top=0
frame.bottom=0
frame.left=0
frame.right=0
text.bold=false
min_height=+0.3font
min_width=+0.3font
frame.expansion=0

[MenuBar]
inherits=PanelButtonCommand
frame.element=menubar
interior.element=menubar
frame.bottom=0
text.normal.color=$foreground
frame.expansion=0

[MenuBarItem]
inherits=PanelButtonCommand
interior=true
interior.element=menubaritem
frame.element=menubaritem
frame.top=2
frame.bottom=2
frame.left=2
frame.right=2
text.margin.left=4
text.margin.right=4
text.margin.top=0
text.margin.bottom=0
text.normal.color=$foreground
text.focus.color=#ffffff
text.bold=false
min_width=+0.3font
min_height=+0.3font
frame.expansion=0

[TitleBar]
inherits=PanelButtonCommand
frame=false
text.margin.top=2
text.margin.bottom=2
text.margin.left=2
text.margin.right=2
interior.element=titlebar
indicator.size=16
indicator.element=mdi
text.normal.color=$foreground
text.focus.color=$foreground
text.bold=false
text.italic=false
frame.expansion=0

[ComboBox]
inherits=PanelButtonCommand
frame.element=combo
interior.element=combo
interior=true
frame.top=2
frame.bottom=2
frame.left=2
frame.right=2
text.margin.top=2
text.margin.bottom=2
text.margin.left=2
text.margin.right=2
text.focus.color=#ffffff
text.press.color=$foreground
text.toggle.color=$foreground
frame.expansion=0

[Menu]
inherits=PanelButtonCommand
frame.top=1
frame.bottom=1
frame.left=1
frame.right=1
frame.element=menu
interior.element=menu
text.normal.color=$foreground
text.shadow=false
frame.expansion=0
text.bold=false

[GroupBox]
inherits=GenericFrame
frame=false
text.shadow=0
text.margin=0
text.normal.color=$foreground
text.focus.color=#ffffff
text.bold=false
frame.expansion=0

[TabBarFrame]
inherits=GenericFrame
frame=true
frame.element=tabBarFrame
interior=false
frame.top=2
frame.bottom=2
frame.left=2
frame.right=2

[ToolTip]
inherits=GenericFrame
frame.top=3
frame.bottom=3
frame.left=3
frame.right=3
interior=true
text.shadow=0
text.margin=0
interior.element=tooltip
frame.element=tooltip
frame.expansion=0

[StatusBar]
inherits=GenericFrame
frame=false
interior=false

[Window]
interior=true
interior.element=window
frame.expansion=0
EOF

# Actualizar esquema de colores KDE
cat > ~/.local/share/color-schemes/PywalColors.colors << EOF
[ColorEffects:Disabled]
Color=56,56,56
ColorAmount=0
ColorEffect=0
ContrastAmount=0.65
ContrastEffect=1
IntensityAmount=0.1
IntensityEffect=2

[ColorEffects:Inactive]
ChangeSelectionColor=true
Color=112,111,110
ColorAmount=0.025
ColorEffect=2
ContrastAmount=0.1
ContrastEffect=2
Enable=false
IntensityAmount=0
IntensityEffect=0

[Colors:Button]
BackgroundAlternate=$(hex_to_rgb "$color0")
BackgroundNormal=$(hex_to_rgb "$color0")
DecorationFocus=$(hex_to_rgb "$color1")
DecorationHover=$(hex_to_rgb "$color1")
ForegroundActive=$(hex_to_rgb "$color4")
ForegroundInactive=$(hex_to_rgb "$color8")
ForegroundLink=$(hex_to_rgb "$color4")
ForegroundNegative=$(hex_to_rgb "$color5")
ForegroundNeutral=$(hex_to_rgb "$color2")
ForegroundNormal=$(hex_to_rgb "$foreground")
ForegroundPositive=$(hex_to_rgb "$color2")
ForegroundVisited=$(hex_to_rgb "$color5")

[Colors:Complementary]
BackgroundAlternate=$(hex_to_rgb "$color0")
BackgroundNormal=$(hex_to_rgb "$background")
DecorationFocus=$(hex_to_rgb "$color1")
DecorationHover=$(hex_to_rgb "$color1")
ForegroundActive=$(hex_to_rgb "$color4")
ForegroundInactive=$(hex_to_rgb "$color8")
ForegroundLink=$(hex_to_rgb "$color4")
ForegroundNegative=$(hex_to_rgb "$color5")
ForegroundNeutral=$(hex_to_rgb "$color2")
ForegroundNormal=$(hex_to_rgb "$foreground")
ForegroundPositive=$(hex_to_rgb "$color2")
ForegroundVisited=$(hex_to_rgb "$color5")

[Colors:Selection]
BackgroundAlternate=$(hex_to_rgb "$color1")
BackgroundNormal=$(hex_to_rgb "$color1")
DecorationFocus=$(hex_to_rgb "$color1")
DecorationHover=$(hex_to_rgb "$color1")
ForegroundActive=255,255,255
ForegroundInactive=$(hex_to_rgb "$foreground")
ForegroundLink=255,255,255
ForegroundNegative=255,255,255
ForegroundNeutral=255,255,255
ForegroundNormal=255,255,255
ForegroundPositive=255,255,255
ForegroundVisited=255,255,255

[Colors:Tooltip]
BackgroundAlternate=$(hex_to_rgb "$color0")
BackgroundNormal=$(hex_to_rgb "$background")
DecorationFocus=$(hex_to_rgb "$color1")
DecorationHover=$(hex_to_rgb "$color1")
ForegroundActive=$(hex_to_rgb "$color4")
ForegroundInactive=$(hex_to_rgb "$color8")
ForegroundLink=$(hex_to_rgb "$color4")
ForegroundNegative=$(hex_to_rgb "$color5")
ForegroundNeutral=$(hex_to_rgb "$color2")
ForegroundNormal=$(hex_to_rgb "$foreground")
ForegroundPositive=$(hex_to_rgb "$color2")
ForegroundVisited=$(hex_to_rgb "$color5")

[Colors:View]
BackgroundAlternate=$(hex_to_rgb "$color0")
BackgroundNormal=$(hex_to_rgb "$background")
DecorationFocus=$(hex_to_rgb "$color1")
DecorationHover=$(hex_to_rgb "$color1")
ForegroundActive=$(hex_to_rgb "$color4")
ForegroundInactive=$(hex_to_rgb "$color8")
ForegroundLink=$(hex_to_rgb "$color4")
ForegroundNegative=$(hex_to_rgb "$color5")
ForegroundNeutral=$(hex_to_rgb "$color2")
ForegroundNormal=$(hex_to_rgb "$foreground")
ForegroundPositive=$(hex_to_rgb "$color2")
ForegroundVisited=$(hex_to_rgb "$color5")

[Colors:Window]
BackgroundAlternate=$(hex_to_rgb "$color0")
BackgroundNormal=$(hex_to_rgb "$background")
DecorationFocus=$(hex_to_rgb "$color1")
DecorationHover=$(hex_to_rgb "$color1")
ForegroundActive=$(hex_to_rgb "$color4")
ForegroundInactive=$(hex_to_rgb "$color8")
ForegroundLink=$(hex_to_rgb "$color4")
ForegroundNegative=$(hex_to_rgb "$color5")
ForegroundNeutral=$(hex_to_rgb "$color2")
ForegroundNormal=$(hex_to_rgb "$foreground")
ForegroundPositive=$(hex_to_rgb "$color2")
ForegroundVisited=$(hex_to_rgb "$color5")

[General]
ColorScheme=PywalColors
Name=Pywal Colors
shadeSortColumn=true

[KDE]
contrast=4

[WM]
activeBackground=$(hex_to_rgb "$background")
activeBlend=$(hex_to_rgb "$background")
activeForeground=$(hex_to_rgb "$foreground")
inactiveBackground=$(hex_to_rgb "$background")
inactiveBlend=$(hex_to_rgb "$background")
inactiveForeground=$(hex_to_rgb "$color8")
EOF

# Configurar qt5ct para usar Kvantum
mkdir -p ~/.config/qt5ct
cat > ~/.config/qt5ct/qt5ct.conf << EOF
[Appearance]
color_scheme_path=/usr/share/qt5ct/colors/darker.conf
custom_palette=false
icon_theme=breeze-dark
standard_dialogs=default
style=kvantum-dark

[Fonts]
fixed=@Variant(\0\0\0@\0\0\0\x12\0\x43\0\x61\0n\0t\0\x61\0r\0\x65\0l\0l@$\0\0\0\0\0\0\xff\xff\xff\xff\x5\x1\0\x32\x10)
general=@Variant(\0\0\0@\0\0\0\x12\0\x43\0\x61\0n\0t\0\x61\0r\0\x65\0l\0l@$\0\0\0\0\0\0\xff\xff\xff\xff\x5\x1\0\x32\x10)

[Interface]
activate_item_on_single_click=1
buttonbox_layout=0
cursor_flash_time=1000
dialog_buttons_have_icons=1
double_click_interval=400
gui_effects=@Invalid()
keyboard_scheme=2
menus_have_icons=true
show_shortcuts_in_context_menus=true
stylesheets=@Invalid()
toolbutton_style=4
underline_shortcut=1
wheel_scroll_lines=3

[SettingsWindow]
geometry=@ByteArray(\x1\xd9\xd0\xcb\0\x3\0\0\0\0\x3\x10\0\0\0\x38\0\0\x6o\0\0\x4\x1f\0\0\x3\x10\0\0\0\x38\0\0\x6o\0\0\x4\x1f\0\0\0\0\0\0\0\0\a\x80\0\0\x3\x10\0\0\0\x38\0\0\x6o\0\0\x4\x1f)

[Troubleshooting]
force_raster_widgets=1
ignored_applications=@Invalid()
EOF

# Aplicar el tema a Dolphin
kwriteconfig5 --file dolphinrc --group General --key ColorScheme PywalColors

echo "âœ… SincronizaciÃ³n completa! Los colores de Qt/KDE ahora coinciden con PyWal."
echo "ðŸ“ Nota: Es posible que necesites reiniciar Dolphin para ver los cambios:"
echo "   killall dolphin && dolphin &"
